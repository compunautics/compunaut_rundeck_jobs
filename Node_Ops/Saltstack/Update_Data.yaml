- defaultTab: monitor
  description: |-
    Use this job to update saltstack data.
    - This job is useful if you need to run other saltstates with updated mine, grains, or pillars.
  executionEnabled: true
  group: Saltstack
  loglevel: INFO
  name: Update Data
  nodeFilterEditable: false
  nodefilters:
    dispatch:
      excludePrecedence: true
      keepgoing: false
      rankOrder: ascending
      successOnEmptyNodeFilter: false
      threadcount: '1'
    filter: 'name: .*salt.*'
  nodesSelectedByDefault: true
  options:
  - description: Specify the targets for updating data.
    name: salt_target
    required: true
    value: '*'
  scheduleEnabled: true
  sequence:
    commands:
    - description: Delete pillar cache
      exec: sudo rm -fv /var/cache/salt/master/pillar_cache/*
    - description: Refresh grains
      exec: sudo salt -C "${option.salt_target}" saltutil.refresh_grains -b6 --batch-wait 15 && sleep 10
    - description: Update mine
      exec: sudo salt -C "${option.salt_target}" mine.update -b6 --batch-wait 15 && sleep 10
    - description: Refresh pillar
      exec: sudo salt -C "${option.salt_target}" saltutil.refresh_pillar -b6 --batch-wait 15 && sleep 10
    - description: Populate pillar cache
      exec: sudo salt -C '${option.salt_target}' pillar.items -b6 --batch-wait 15 1>/dev/null && sleep 10
    keepgoing: false
    strategy: node-first
  timeout: '900'

